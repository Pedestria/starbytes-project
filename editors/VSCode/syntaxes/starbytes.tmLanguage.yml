name: 'Starbytes Syntax'
scopeName: 'source.starb'
uuid: 86e272a9-6421-4db5-a7b8-01d296c9fca5
fileTypes: ['starb', 'stb']
foldingStartMarker: '\{\s*$'
foldingStopMarker: '^\s*\}'

variables:
  identifier: '[A-Za-z_][A-Za-z0-9_]*'
  qualifiedIdentifier: '{{identifier}}(?:\.{{identifier}})*'
  builtinType: '(?:Void|String|Bool|Array|Dict|Int|Float|Regex|Any|Task)'
  typeToken: '(?:{{builtinType}}|{{identifier}})'
  keywordDecl: '(?:import|scope|class|struct|interface|enum|decl|func|lazy|new|def|imut)'
  keywordCtrl: '(?:if|elif|else|for|while|return|secure|catch|await|is)'
  reservedWords: '(?:{{keywordDecl}}|{{keywordCtrl}}|true|false)'
  number: '(?:0|[1-9][0-9]*)(?:\.[0-9]+)?'

patterns:
  - include: '#comments'
  - include: '#strings'
  - include: '#regex'
  - include: '#attributes'
  - include: '#imports'
  - include: '#type-alias'
  - include: '#type-and-scope-declarations'
  - include: '#function-declarations'
  - include: '#constructor-declarations'
  - include: '#variable-declarations'
  - include: '#control-keywords'
  - include: '#booleans'
  - include: '#numbers'
  - include: '#types'
  - include: '#operators'
  - include: '#calls'
  - include: '#member-access'

repository:
  comments:
    patterns:
      - name: 'comment.line.double-slash.starb'
        match: '//.*$'
      - name: 'comment.block.starb'
        begin: '/\*'
        end: '\*/'

  strings:
    patterns:
      - name: 'string.quoted.double.starb'
        begin: '"'
        end: '"'
        patterns:
          - name: 'constant.character.escape.starb'
            match: '\\.'

  regex:
    patterns:
      - name: 'string.regexp.starb'
        match: '(?<![/\w])/(?![/*])(?:\\.|[^/\\\n])+/[a-zA-Z]*'

  attributes:
    patterns:
      - name: 'meta.annotation.starb'
        begin: '(@)({{identifier}})\s*(\()'
        end: '\)'
        beginCaptures:
          '1':
            name: 'punctuation.definition.annotation.starb'
          '2':
            name: 'entity.name.tag.annotation.starb'
          '3':
            name: 'punctuation.section.group.begin.starb'
        endCaptures:
          '0':
            name: 'punctuation.section.group.end.starb'
        patterns:
          - include: '#strings'
          - include: '#numbers'
          - include: '#booleans'
          - include: '#operators'
      - name: 'meta.annotation.starb'
        match: '(@)({{identifier}})'
        captures:
          '1':
            name: 'punctuation.definition.annotation.starb'
          '2':
            name: 'entity.name.tag.annotation.starb'

  imports:
    patterns:
      - name: 'meta.import.starb'
        match: '\b(import)\s+({{qualifiedIdentifier}})'
        captures:
          '1':
            name: 'keyword.control.import.starb'
          '2':
            name: 'entity.name.namespace.starb'

  type-alias:
    patterns:
      - name: 'meta.type.alias.starb'
        begin: '\b(def)\s+({{identifier}})\b'
        end: '(?=$)'
        beginCaptures:
          '1':
            name: 'keyword.declaration.typealias.starb'
          '2':
            name: 'entity.name.type.starb'
        patterns:
          - include: '#types'
          - include: '#operators'
          - include: '#numbers'

  type-and-scope-declarations:
    patterns:
      - name: 'meta.scope.declaration.starb'
        match: '\b(scope)\s+({{identifier}})\b'
        captures:
          '1':
            name: 'keyword.declaration.scope.starb'
          '2':
            name: 'entity.name.namespace.starb'
      - name: 'meta.type.declaration.starb'
        match: '\b(class|struct|interface|enum)\s+({{identifier}})\b'
        captures:
          '1':
            name: 'keyword.declaration.type.starb'
          '2':
            name: 'entity.name.type.starb'

  function-declarations:
    patterns:
      - name: 'meta.function.declaration.starb'
        match: '\b((?:lazy\s+)?func)\s+({{identifier}})\b'
        captures:
          '1':
            name: 'keyword.declaration.function.starb'
          '2':
            name: 'entity.name.function.starb'

  constructor-declarations:
    patterns:
      - name: 'meta.constructor.starb'
        match: '\b(new)\b(?=\s*\()'
        captures:
          '1':
            name: 'keyword.declaration.constructor.starb'

  variable-declarations:
    patterns:
      - name: 'meta.variable.declaration.starb'
        match: '\b(decl)\s+(imut\s+)?(func\s+)?({{identifier}})\s*(\[\s*\])?'
        captures:
          '1':
            name: 'keyword.declaration.variable.starb'
          '2':
            name: 'storage.modifier.immutable.starb'
          '3':
            name: 'keyword.declaration.function.starb'
          '4':
            name: 'variable.other.definition.starb'
          '5':
            name: 'storage.modifier.array.inferred.starb'
      - name: 'meta.catch.parameter.starb'
        match: '\b(catch)\s*\(\s*({{identifier}})\s*:\s*({{typeToken}})'
        captures:
          '1':
            name: 'keyword.control.exception.starb'
          '2':
            name: 'variable.parameter.catch.starb'
          '3':
            name: 'entity.name.type.starb'

  control-keywords:
    patterns:
      - name: 'keyword.control.starb'
        match: '\b(if|elif|else|for|while|return|secure|catch|await|is)\b'
      - name: 'storage.modifier.immutable.starb'
        match: '\bimut\b'

  booleans:
    patterns:
      - name: 'constant.language.boolean.starb'
        match: '\b(true|false)\b'

  numbers:
    patterns:
      - name: 'constant.numeric.starb'
        match: '\b{{number}}\b'

  types:
    patterns:
      - name: 'support.type.builtin.starb'
        match: '\b{{builtinType}}\b'
      - name: 'entity.name.type.starb'
        match: '\b[A-Z][A-Za-z0-9_]*\b'

  operators:
    patterns:
      - name: 'keyword.operator.comparison.starb'
        match: '==|!=|<=|>=|<|>'
      - name: 'keyword.operator.assignment.starb'
        match: '<<=|>>=|\+=|-=|\*=|/=|%=|&=|\|=|\^=|=(?!=)'
      - name: 'keyword.operator.logical.starb'
        match: '&&|\|\|'
      - name: 'keyword.operator.bitwise.starb'
        match: '<<|>>|&|\||\^|~'
      - name: 'keyword.operator.arithmetic.starb'
        match: '\+|-|\*|/|%'
      - name: 'keyword.operator.ternary.starb'
        match: '\?|:'

  calls:
    patterns:
      - name: 'meta.function-call.starb'
        match: '\b(?!{{reservedWords}}\b)({{identifier}})\b(?=\s*\()'
        captures:
          '1':
            name: 'entity.name.function.call.starb'

  member-access:
    patterns:
      - name: 'meta.member.access.starb'
        match: '(\.)({{identifier}})'
        captures:
          '1':
            name: 'punctuation.accessor.dot.starb'
          '2':
            name: 'variable.other.member.starb'
  
